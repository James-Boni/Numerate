Implement a new game mode called **Quick Fire** with BOTH:
(A) correct backend/gameplay logic and data integrity, AND
(B) polished UX/UI behavior exactly as specified.

This is a SURGICAL task:
- Reuse the existing Daily engine wherever possible (question generator, difficulty profile, answer input patterns, styling).
- Do NOT break existing Daily or Assessment flows.
- Do NOT add any debug panels/blocks to the user UI.
- Any diagnostics must be console-only.

This mode must feel native to Numerate: silky, consistent, friendly, and framed as training (not judgement).

====================================================================
0) DEFINITIONS / INTENT (LOCK THIS IN)
====================================================================
Quick Fire is a speed-training drill:
- Purpose: improve speed + automaticity for Daily challenge.
- It is NOT “make or break”, NOT a judgement of ability.
- It provides a personal best (high score) and reliable speed data.

====================================================================
1) AVAILABILITY + NAVIGATION PLACEMENT
====================================================================
1.1 Gating:
- Quick Fire must only be accessible once the initial assessment is completed.
- Condition: store.user.hasCompletedAssessment === true
- Same gating behavior as the Daily challenge.

1.2 Placement in UI:
- On the main play/home screen (where Daily is listed), add Quick Fire BELOW “3 minute Daily Challenge”.
- It should appear as a similar card/button style, consistent with the app.

1.3 Routing:
- Add a route/screen for Quick Fire that reuses the same base session screen structure as Daily where possible.
- Ensure sessionType for this mode is EXACTLY: "quick_fire" (never "daily" or "assessment").

====================================================================
2) FIRST-TIME INTRO POPUP (SILKY)
====================================================================
2.1 First-run only:
- When user taps Quick Fire for the first time, show a modal popup explaining rules briefly.
- Persist a flag: quickFireIntroSeen (per user/device, same persistence strategy as your user state).
- If quickFireIntroSeen === true, do not show the modal again.

2.2 Popup content (short, friendly, training framed):
Title: “Quick Fire”
Body (example copy; keep tone consistent):
- “You have 4 seconds per question.”
- “Each correct answer increases your score.”
- “One mistake ends the run.”
- “This is speed training to make Daily challenges feel easier.”
Button: “Okay”

2.3 UI requirements:
- Modal must be silky smooth and consistent with Numerate’s design system.
- Use existing modal components/styles if present.

====================================================================
3) PRE-GAME COUNTDOWN (3–2–1) EXACT SPEC
====================================================================
After user presses “Okay” on the intro popup, Quick Fire must start with a countdown.

3.1 Visual:
- Full-screen overlay with WHITE background.
- Centered large number: “3”, then “2”, then “1”.
- Each number must:
  - appear centered
  - take up a large portion of the screen
  - flash in and enlarge slightly (scale-up) then exit
- Total countdown duration MUST be exactly 3.0 seconds:
  - “3” displayed for 1000ms
  - “2” displayed for 1000ms
  - “1” displayed for 1000ms

3.2 Audio:
- Play a “game-like horn” sound on each number (3,2,1).
- After “1”, play a final, slightly higher-pitch horn that instinctively signals “GO / game has begun”.
- Audio must be tightly synchronized with each number.

3.3 Transition:
- At exactly 3000ms after countdown starts, remove overlay instantly and show the first question.

====================================================================
4) CORE GAME RULES (MUST MATCH EXACTLY)
====================================================================
4.1 Time limit per question:
- User has EXACTLY 4.0 seconds to answer each question.
- Timer resets to 4.0 seconds when a new question is rendered.
- Timer must stop immediately upon submission (correct or incorrect).

4.2 End condition:
- The run ends immediately when the user:
  - gets ONE wrong, OR
  - runs out of time (timer reaches 0.0), OR
  - any critical state error occurs (fail-safe end run rather than continue).

4.3 Difficulty logic:
- Difficulty MUST match the user’s current level, exactly like Daily.
- Single source of truth: store.user.level
- Use existing getDifficultyProfile(level) and question generator logic.
- DO NOT default to “easy addition-only” unless that’s what the level’s profile actually dictates.

4.4 Score:
- Score starts at 0.
- Score increases by +1 per correct answer.
- No score multipliers accrue in this mode.

====================================================================
5) INPUT / SUBMISSION CONTRACT (NO RACE CONDITIONS)
====================================================================
5.1 Single submit protection:
- Prevent double submit.
- After submit, disable input until next question is shown or run ends.

5.2 Response time capture:
- For each question, store:
  - questionShownTimestamp
  - submitTimestamp (if submitted)
  - responseTimeMs = submitTimestamp - questionShownTimestamp
- responseTimesMs must match attemptedN count.

5.3 Correct submission flow:
On submit:
- stop timer immediately
- attemptedN++
- if correct:
   - correctC++
   - score += 1
   - inGameXP += 2
   - immediately render the next question
   - restart question timer at 4.0 seconds
- if incorrect:
   - end run immediately (no next question)

5.4 Timeout flow:
- If timer hits 0.0 before a submission:
  - treat as incorrect
  - end run immediately
- Ensure timer interval/raf is fully cleaned up on end.

====================================================================
6) IN-GAME UI / UX REQUIREMENTS (CONSISTENT + SPECIFIC)
====================================================================
6.1 Overall layout:
- The question/input format should match the Daily game.
- Use the same typography, spacing, and interactions where possible.

6.2 Score watermark in answer area:
- Display current score in LARGE text inside the answer box area as a watermark/background.
- Color must be the same blue used elsewhere in the app.
- It must not distract:
  - low opacity
  - behind the user’s input
- It must be easily glanceable with minimal eye movement.

6.3 4-second timer display and behavior:
- Timer must be shown in RED.
- It must “beat/pulse” like the Daily timer does in the final 10 seconds:
  - reuse that pulse animation behavior for Quick Fire’s timer
- Audio ticking:
  - quietly ticking in the background while timer runs
  - must not be too loud or anxiety-inducing
  - must stop immediately upon submission and on run end
- Ensure the ticking does not overlap into next question incorrectly and never continues into summary.

====================================================================
7) XP DESIGN (CRITICAL: IN-GAME XP + ADDITIONAL XP MUST SUM)
====================================================================
This has been a recurring failure. Implement it exactly.

7.1 In-game XP (the XP earned during the run):
- inGameXP = 2 * correctC
- No multipliers accrue in Quick Fire:
  - no streak multipliers
  - no speed multipliers
  - no exponential boosts
- The top-right XP counter during gameplay (if present) must reflect inGameXP accurately.

7.2 Additional XP (post-session bonus XP):
- Quick Fire can produce some additional XP based on session metrics, BUT it must be minimal.
- Multipliers are DISABLED for Quick Fire:
  - excellenceMultiplier = 1.0
  - eliteMultiplier = 1.0
- Compute computedBonusXP using your existing metric system (accuracy/speed/consistency/throughput/effort), but with multipliers forced to 1.0.
- Then CAP it so it cannot dominate:
   bonusXP = min( floor(inGameXP * 0.25), computedBonusXP )
- If metrics pipeline is not stable enough, acceptable fallback for Quick Fire only:
   bonusXP = 0
  (InGameXP must still work.)

7.3 Final XP (single number):
- finalSessionXP = inGameXP + bonusXP
- The results screen must show ONLY one number: “X XP” where X is finalSessionXP.
- Do NOT display any breakdown like “in-game + bonus”.

7.4 XP Integrity rule:
The exact same finalSessionXP must be:
- shown in the UI (“X XP”)
- applied to leveling progression
- stored in the session record

Add a CONSOLE-ONLY log at end:
XP_SUMMARY mode=quick_fire inGameXP=__ bonusXP=__ finalSessionXP=__ appliedToLeveling=__ storedFinal=__

NO NEW DEBUG UI.

====================================================================
8) SESSION SUMMARY PAGE (FRIENDLY, CONSISTENT)
====================================================================
8.1 When the run ends:
- end immediately and transition to a summary page.
- stop all timer sounds immediately.

8.2 Summary content (consistent with app):
Show:
- Score (correct answers)
- Attempted
- Accuracy
- Median time
- XP earned: show only “X XP” (finalSessionXP)

8.3 Tone/copy:
- Training framing:
  - “Quick Fire complete”
  - “This is speed training to strengthen Daily sessions.”
- Avoid judgement language:
  - do NOT say “fail”, “game over”, “you lost”.

====================================================================
9) HIGH SCORE (PERSONAL BEST) + CELEBRATION
====================================================================
9.1 Persistence:
- Persist quickFireHighScore per user/device:
  - integer, default 0

9.2 Update rule:
- If score > quickFireHighScore:
  - update stored high score
  - show a positive message: “New personal best!”
  - play a short CHEER sound
  - show subtle confetti falling in the background (consistent with app style)
- If score <= quickFireHighScore:
  - show: “Personal best: X”
- Do NOT celebrate ties.

9.3 Confetti/cheer:
- Must be short and satisfying, not overwhelming.
- Must not interfere with readability of summary stats.

====================================================================
10) STORAGE / DATA CAPTURE (FOR PROGRESS TAB LATER)
====================================================================
Store a Quick Fire session record with:
- sessionType: "quick_fire"
- timestamp
- levelUsed (store.user.level at start)
- score
- attemptedN, correctC
- accuracy
- responseTimesMs summary (medianMs, variabilityMs if available)
- durationSeconds (run length)
- inGameXP, bonusXP, finalSessionXP
This enables speed trend graphs later.

====================================================================
11) AUDIO ASSET REQUIREMENTS (DO NOT CHOOSE WEIRD SOUNDS)
====================================================================
- Countdown horn sounds must be short, game-like, and consistent with Numerate’s aesthetic.
- The ticking sound must be quiet and not stressful.
- Cheer sound must be short and uplifting (not cartoonish).
- Ensure audio plays instantly and does not overlap incorrectly across questions or into summary.

If existing audio system is present, reuse it and add these sound assets in the same pattern.

====================================================================
12) IMPLEMENTATION GUIDANCE (KEEP IT CLEAN)
====================================================================
- Reuse existing Daily components and logic as much as possible.
- Add a Quick Fire config entry and minimal branching by sessionType.
- Do not create new scoring systems; score and inGameXP are simple counters.
- Ensure timers are robust: use a single interval or animation frame with proper cleanup.
- Ensure state is not cleared before summary is computed (prevents XP loss/0 bugs).

====================================================================
13) ACCEPTANCE CHECKLIST (MUST PASS)
====================================================================
A) Access:
- Quick Fire appears only after assessment completion and sits below Daily.

B) Intro modal:
- Appears only first time, silky UI, “Okay” starts countdown.

C) Countdown:
- White background, 3→2→1 exactly 3 seconds total, horn on each, higher-pitch “GO” at start.

D) Gameplay:
- 4.0 seconds per question, timer resets each question.
- Score starts at 0 and increments by +1 per correct.
- Run ends immediately on first wrong or timeout.
- Difficulty matches user.level (same generator/difficulty as Daily).

E) UI:
- Score watermark in answer area in app blue, low opacity.
- Timer in red with pulsing animation, quiet ticking that stops correctly.

F) Summary:
- Friendly training framed copy.
- Shows Score, Attempted, Accuracy, Median time.
- Shows a SINGLE “X XP” number (finalSessionXP).

G) XP correctness:
- inGameXP = 2 * correct
- bonusXP capped <= 25% of inGameXP and no multipliers
- finalSessionXP = inGameXP + bonusXP
- finalSessionXP is shown == stored == applied

H) High score:
- PB saved and celebrated with cheer + subtle confetti + “New personal best!”
- No celebration on ties.

Return:
- a concise list of files changed/added
- where the new Quick Fire entry is wired into the home screen
- where quickFireIntroSeen and quickFireHighScore are stored
- where countdown/timer logic is implemented
- confirm XP integrity with a sample console log line XP_SUMMARY